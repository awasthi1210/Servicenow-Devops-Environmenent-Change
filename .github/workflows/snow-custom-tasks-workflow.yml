name: GitHub Environment Change
on: workflow_dispatch
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: "11"
          distribution: temurin
          cache: maven
      - name: Build with Maven
        run: mvn clean compile
  deploy:
      name: Deploy
      environment: PROD
      needs: build
      runs-on: ubuntu-latest
      steps:
        - name: Run deployment scripts
          run: echo Completed running deployment script
  getchange:
      name: GetChange
      needs: deploy
      runs-on: ubuntu-latest
      steps:
        - name: ServiceNow Get Change
          uses: ServiceNow/servicenow-devops-get-change@v6.1
          with:
            devops-integration-user-name: ${{ secrets.SN_DEVOPS_USER }}
            devops-integration-user-password: ${{ secrets.SN_DEVOPS_PASSWORD }}
            instance-url: ${{ secrets.SN_INSTANCE_URL }}
            tool-id: ${{ secrets.SN_ORCHESTRATION_TOOL_ID }}
            context-github: ${{ toJSON(github) }}
            job-name: Deploy
            change-details: '{"build_number":"21","pipeline_name":"CI_Pipeline","stage_name":"Create_Change"}'
  postdeploy:
      name: Post Deploy
      needs: deploy
      runs-on: ubuntu-latest
      steps:
        - name: Run deployment scripts
          run: echo Completed Deployment
